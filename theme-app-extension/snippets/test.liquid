<script src="{{ 'cod-form.js' | asset_url }}" defer></script>
<div id="shopify-block-ac56f1e0-fac5-41ff-b78e-2d5c7523b81a" class="shopify-block shopify-app-block" data-shopify-editor-block="{&quot;id&quot;:&quot;ac56f1e0-fac5-41ff-b78e-2d5c7523b81a&quot;,&quot;type&quot;:&quot;shopify://apps/leadform-easy-order-cod-form/blocks/LeadForm-COD/3a127389-69cb-41d6-8e5c-10311613fcf7&quot;,&quot;disabled&quot;:false}"><!-- BEGIN app snippet: leadform_cod --><div id="advanced-cod" data-product_id="7377367236764" data-product="Product 1" data-price="100.0" data-currency="MAD" data-atc_target=".product-form__buttons" data-quantity_target=".product-form__quantity" data-display="initial" style="display: initial;">	<div class="formPreview">
		<div class="card h-100" style="border-color: #ebebeb;border-width: 0px; border-radius: 2px; background: rgba(0, 0, 0, 0) linear-gradient(rgb(148, 148, 148), rgb(255, 255, 255)) repeat scroll 0% 0%;">
		<div class="card-body p-3">
			<h6 class="text-center mb-3 mt-3 formTitle" style="font-size: 20px; color: rgb(255, 255, 255);font-weight: bold;">Form title</h6>			<h6 class="text-center mb-2 formSubTitle" style="font-size: 19px; color: rgb(229, 229, 229);">Both titles can be removed/edited</h6>			<div id="preferencePreviewForm">
														<label style="color:#fef7f5">
						First Name					</label>
										<div class="input-group mb-2">
												<span class="input-group-text text-body"><i aria-hidden="true" class="fa fa-user" style="color: rgb(37, 29, 16);"></i></span>
												<input type="text" class=" form-control advanced_field " name="firstname" data-field="firstname" data-required="First name is required" data-error="First name should not contain any numeric characters" placeholder="First Name">
											</div>
																																	<label style="color:#fef7f5">
							Province						</label>
																		
						<div class="input-group mb-2">
														<span class="input-group-text text-body"><i aria-hidden="true" class="fa fa-map-signs" style="color: rgb(37, 29, 16);"></i></span>
														<input type="text" class=" form-control advanced_field " name="chippingprovince" data-field="chippingprovince" data-required="Province is required" data-error="" placeholder="Province">
													</div>
																									<label style="color:#fef7f5">
						Note					</label>
										<div class="input-group mb-2">
												<span class="input-group-text text-body"><i aria-hidden="true" class="fa fa-sticky-note" style="color: rgb(37, 29, 16);"></i></span>
												<input type="text" class=" form-control advanced_field " name="note" data-field="note" data-required="" data-error="" placeholder="Note">
											</div>
																			<label style="color:#fef7f5">
						Phone						<span class="text-danger" title="required"> *</span>
											</label>
										<div class="input-group mb-2">
												<span class="input-group-text text-body"><i aria-hidden="true" class="fa fa-phone" style="color: rgb(37, 29, 16);"></i></span>
												<input type="tel" class="lead_last_field form-control advanced_field advanced_required" name="phone" data-field="phone" data-required="Phone is required" data-error="Please enter a valid phone number" placeholder="Phone">
											</div>
												</div>
			
			<!-- Quantity -->
			
						<div class="quantityForm mt-3">
				<div class="quantitySection">
								<div class="d-flex">
									<label class="mt-2 mr-2" style="color:#fef7f5">
										Qty:
									</label>
									<div class="leadform-quantity " style="background: #ffffff none repeat scroll 0% 0%; border-radius: 2px;">
										<button type="button" class="lead_quantity__button adv_qt_down">
										  <svg style="color: #2c2414;" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" role="presentation" class="fa fa-minus" fill="none" viewBox="0 0 10 2">
											<path fill-rule="evenodd" clip-rule="evenodd" d="M.5 1C.5.7.7.5 1 .5h8a.5.5 0 110 1H1A.5.5 0 01.5 1z" fill="currentColor">
											</path></svg>
										</button>
										<input type="number" name="quantity" min="1" value="1" id="" class="lead_quantity__input">
										<button type="button" class="lead_quantity__button adv_qt_up">
										  <svg style="color: #2c2414;" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" role="presentation" class="fa fa-plus" fill="none" viewBox="0 0 10 10">
											<path fill-rule="evenodd" clip-rule="evenodd" d="M1 4.51a.5.5 0 000 1h3.5l.01 3.5a.5.5 0 001-.01V5.5l3.5-.01a.5.5 0 00-.01-1H5.5L5.49.99a.5.5 0 00-1 .01v3.5l-3.5.01H1z" fill="currentColor">
											</path></svg>
										</button>
									</div>
								</div>
							</div>			</div>
						
			<!-- Coupon -->
			
						<div class="couponForm mt-3">
				<div class="input-group">
					<input type="text" class="form-control couponCode" placeholder="Coupon code" style="border-top-right-radius: inherit !important;border-bottom-right-radius: inherit !important;">
					<button type="button" class="btn ml-2 couponButton" style="background: rgb(115, 89, 43) none repeat scroll 0% 0%;border-radius: 4px;color: rgb(255, 255, 255);margin-bottom: 0;">Apply</button>
				</div>
			</div>
						
			<!-- Bundle -->
			
			<div class="bundlePreview">
				<!-- append bundle options here -->
			</div>

			<!-- Summary -->
						
			<!-- Variants -->
			<div class="leadform_variants">
			<!-- Shopify Variants -->
			</div>
			
						<div class="card border-radius-md summaryForm mt-3" style="background: rgb(192, 192, 192) none repeat scroll 0% 0%;">
				<div class="card-body p-3">
					<div class="justify-content-center align-items-center">
						<p class="summaryTitle text-center text-bold" style="color:#4f4f4f;font-size:18px;">Order summary</p>
					</div>
					<div class="row justify-content-center align-items-center subotalSection">
						<div class="col-sm-auto col-8 my-auto ">
							<p class="subTotalTitle m-0" style="color:#585858;font-size:17px;">SubTotal</p>
						</div>
						<div class="col-sm-auto mt-sm-0 ms-sm-auto d-flex">
							<p class="subTotalPrice m-0" style="color:#646464;font-size:17px;">100.00 MAD</p>
						</div>
					</div>
										<div class="row justify-content-center align-items-center deliverySection">
						<div class="col-sm-auto col-8 my-auto ">
							<p class="deliveryTitle m-0" style="color:#7d7d7d;font-size:16px;">Delivery fees</p>
						</div>
						<div class="col-sm-auto mt-sm-0 ms-sm-auto d-flex">
							<p class="m-0"><span class="deliveryPrice" style="color:#747981;font-size:16px;">0.00 MAD</span></p>
						</div>
					</div>
															<div class="row justify-content-center align-items-center reductionSection">
						<div class="col-sm-auto col-8 my-auto ">
							<p class="reductionTitle m-0" style="color:#757575;font-size:16px;">Discount</p>
						</div>
						<div class="col-sm-auto mt-sm-0 ms-sm-auto d-flex">
							<p class="m-0"><span class="reductionPrice" style="color:#737779;font-size:16px;">0.00 MAD</span></p>
						</div>
					</div>
										<hr class="horizontal bg-dark m-2">
					<div class="row justify-content-center align-items-center totalSection">
						<div class="col-sm-auto col-8 my-auto ">
							<p class="totalTitle m-0 text-bold" style="color:#3f3f3f;font-size:18px;">Total</p>
						</div>
						<div class="col-sm-auto mt-sm-0 ms-sm-auto d-flex">
							<p class="m-0 text-bold"><span class="totalPrice" style="color:#3a3a3a;font-size:18px;">100.00 MAD</span></p>
						</div>
					</div>
				</div>
			</div>
						
			<!-- Button -->
						<button type="button" class="mt-2 advanced_send_inquery btn leadform-tada btn-shadow" style="width: 100%;color:#ffffff;border-color:#8c672f;font-size:23px;border-width:1px;border-radius:4px;background-image:linear-gradient(310deg, #695127, #bf954f) !important">Confirm order</button>
		</div>
	</div>
</div>
<input class="advancedEvents" data-popup="InitiateCheckout" data-send_event="Purchase" hidden="hidden">

		<!-- Sticky Button -->
		
		
		<!-- Load Sticky Button -->
	<script>
	var app_url		= 'https://leadform.braquets.dev/';
	var shop_name 	= "elbeqqaldevapp.myshopify.com";
		product_id  = $('#advanced-cod').data('product_id');

	$('body').append($('.stickyHtml').html());
	$('.stickyHtml').remove();
	
	// if(shop_name === 'shopperu-pe.myshopify.com'){
		// $('.formPreview').html('<h2>LeadForm COD: Plan not activated, please choose a plan to use our app !</h2>');
	// }

	// $(document).on('change', '.advanced_field', function(){
		// $btn = $(this);
		// $('html,body').animate({
			// scrollTop: $btn.offset().top
		// }, 'slow');
	// });

	$(document).on('change', '.advanced_field', function(){
		$('.sticky-banner').attr('hidden', 'hidden');
	});

	$(document).on('click', '#scrollToLeadForm', function(){
		$('html,body').animate({
			scrollTop: $("#advanced-cod").offset().top
		}, 'slow');
		$('.sticky-banner').attr('hidden', 'hidden');
	});

	/* Province list */
	$( document ).on('change', '.select-Dropdown_citie', function(){
		$checkbox 		= $(this);
		var postal_code = $checkbox.children(':selected').data('postal_code');
		$('input[name="zip"]').val(postal_code);
		// $('input[name="zip"]').attr('disabled', 'disabled');
	});

	$( document ).on('change', '.select-Dropdown_province', function(){
		$checkbox 	= $(this);
		var model = $checkbox.children(':selected').data('model');
			model_id = $checkbox.children(':selected').data('model_id');
		if(model && model_id){
			// console.log(model);
			$.ajax({
			  url: app_url + "customers/getCities",
			  type: 'POST',
			  data: {shop_name: shop_name, model: model, model_id: model_id},
			  success:function( response )
			  {
				var $select_city 	= $('.select-Dropdown_citie');
					placeholder		= $select_city.children(':first').text();
					city_options	= '<option data-select_placeholder="true" value="0">' + placeholder + '</option>' + response;
				
				/* Update City Select Options */
				$select_city.html(city_options);
			  }
			});
		}
	});

	// $( document ).ready(function(){
		// abandoned_checkout();
	// });


	/* Auto fill informations */
	function abandoned_checkout(){
		var token = getUrlParameter('leadform_abandoned');
		if(token){
			$.ajax({
				url: app_url + "abandoneds/check/" + shop_name + '/' + token,
				type: 'POST',
				success:function(result)
				{
					if(result){
						response = jQuery.parseJSON( result );
						$('input[data-field="phone"]').val(response.phone);
						$('input[data-field="lastname"]').val(response.lastname);
						$('input[data-field="firstname"]').val(response.firstname);
						$('input[data-field="chippingcountry"]').val(response.chippingcountry);
						$('input[data-field="chippingprovince"]').val(response.chippingprovince);
						$('input[data-field="chippingcity"]').val(response.chippingcity);
						$('input[data-field="chippingaddress1"]').val(response.chippingaddress1);
						$('input[data-field="chippingaddress2"]').val(response.chippingaddress2);
					}
				}
			 });
		}
	}

	setTimeout(function() { 
		abandoned_checkout();
	}, 1000);

	/* Auto fill informations */
	function visitor_source(){
		var source = getUrlParameter('utm_source');
			fbclid = getUrlParameter('fbclid');
			gclid  = getUrlParameter('gclid');
			
		if(!source){
			if(document.referrer.includes("google")){
				source = 'google';
			}else if(document.referrer.includes("facebook")){
				source = 'facebook';
			}else if(document.referrer.includes("instagram")){
				source = 'instagram';
			}else if(document.referrer.includes("tiktok")){
				source = 'tiktok';
			}else if(document.referrer.includes("snapchat")){
				source = 'snapchat';
			}
		}

		var device = 'laptop';
		if( /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent) ) {
			var device = 'mobile';
		}
		$.ajax({
			url: app_url + "customers/ads",
			type: 'POST',
			data: {shop_name: shop_name, product_id: product_id, gclid: gclid, fbclid: fbclid, source: source, device: device, json: ''},
			success:function(result)
			{
				// time_spent();
				visitor_info();
			}
		});
	}

	setTimeout(function() { 
		visitor_source();
	}, 3000);

	function visitor_info(){
		$.get("https://ipinfo.io/json", function (response) {
			$.ajax({
				url: app_url + "customers/ads",
				type: 'POST',
				data: {shop_name: shop_name, product_id: product_id, json: response},
				success:function(result)
				{

				}
			});
		}, "jsonp");
	}
	
	function time_spent(){
		window.setInterval(function(){
			$.ajax({
				url: app_url + "customers/average",
				type: 'POST',
				data: {shop_name: shop_name, product_id: product_id},
				success:function(result)
				{
					console.log(result);
				}
			})
		}, 30000);
	}


	/* Arabic Number to English one */
	function fixNumbers(str){
	  var persianNumbers = [/۰/g, /۱/g, /۲/g, /۳/g, /۴/g, /۵/g, /۶/g, /۷/g, /۸/g, /۹/g],
		  arabicNumbers  = [/٠/g, /١/g, /٢/g, /٣/g, /٤/g, /٥/g, /٦/g, /٧/g, /٨/g, /٩/g],
		  str			 = str;
		  if(typeof str === 'string')
		  {
			for(var i=0; i<10; i++)
			{
			  str = str.replace(persianNumbers[i], i).replace(arabicNumbers[i], i);
			}
		  }
	  return str;
	}

	/* Arabic Number to English one */
	$( document ).on('change', 'input[data-field="phone"]', function(){
	  $btn = $(this);
	  var phone = $btn.val();
	  phone = fixNumbers(phone);
	  $btn.val(phone);

	});

	/* Get variant from URL */
		var getUrlParameter = function getUrlParameter(sParam) {
		  var sPageURL = window.location.search.substring(1),
			  sURLVariables = sPageURL.split('&'),
			  sParameterName,
			  i;

		  for (i = 0; i < sURLVariables.length; i++) {
			sParameterName = sURLVariables[i].split('=');

			if (sParameterName[0] === sParam) {
			  return sParameterName[1] === undefined ? true : decodeURIComponent(sParameterName[1]);
			}
		  }
		};

	/*
	$(window).scroll(function() {
	   var hT = $('#advanced-cod').offset().top,
		   hH = $('#advanced-cod').outerHeight(),
		   wH = $(window).height(),
		   wS = $(this).scrollTop();
		if (wS > (hT+hH-wH)){
			$('.sticky-banner').removeAttr('hidden');
		}else{
			$('.sticky-banner').attr('hidden', 'hidden');
		}
	});
	*/
	// function isScrolledIntoView(elem) { if($(elem).length){ var $window = $(window), docViewTop = $window.scrollTop(), docViewBottom = docViewTop + $window.height(), elemTop = $(elem).offset().top, elemBottom = elemTop + $(elem).outerHeight(); return ((elemBottom <= docViewBottom) && (elemTop >= docViewTop)); } }

	// $(window).on("scroll", function() {
		// if (isScrolledIntoView('#advanced-cod')) {
			// $('.sticky-banner').attr('hidden', 'hidden');
		// } else {
			// $('.sticky-banner').removeAttr('hidden');
		// }
	// });
	</script>

<!-- Upsell to append -->
<div id="AdCODUpSell" style="display: none !important">
<script>
(function ($) {
	setInterval(function(){
      if($('#upsellConfirm')[0]){
        $('.shopCurrency').text($('#advanced-cod').data('currency'));
      }
    },500);
	console.log($('#advanced-cod').data('currency'));

})(jQuery);
</script></div>
</div><!-- END app snippet -->

<div class="modal fade" id="advancedCodModalForm"><div class="modal-dialog"><div class="modal-content"><div class="modal-body advanced_cod-content"></div></div></div></div>
</div>